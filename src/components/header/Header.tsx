'use server';

import * as featcurrentuser from "@/features/current-user";
import * as featuser from "@/features/user/server";

import { HeaderButton } from "./HeaderButton";
import { HeaderFinder } from "./HeaderFinder";

export const Header = async () => {
  const res = await featcurrentuser.api.get();
  const isAuthenticated = res && !res.errors;

  return (
    <header className="h-12 bg-white border-b border-slate-200 flex items-center justify-center box-content fixed top-0 left-0 w-full z-50">
      <div className="container flex h-full items-center">
        <div className="flex items-center basis-[15%] shrink-0 mr-1 h-[24px] pl-1">
          <svg className="h-full" height="48" viewBox="0 0 212 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M76.0332 23.6046C76.0332 26.1425 75.5522 28.3016 74.5901 30.0819C73.6355 31.8622 72.3325 33.2221 70.681 34.1615C69.037 35.0933 67.1885 35.5592 65.1355 35.5592C63.0673 35.5592 61.2113 35.0895 59.5673 34.1501C57.9234 33.2107 56.6241 31.8508 55.6696 30.0705C54.7151 28.2902 54.2378 26.1349 54.2378 23.6046C54.2378 21.0668 54.7151 18.9077 55.6696 17.1274C56.6241 15.3471 57.9234 13.991 59.5673 13.0592C61.2113 12.1198 63.0673 11.6501 65.1355 11.6501C67.1885 11.6501 69.037 12.1198 70.681 13.0592C72.3325 13.991 73.6355 15.3471 74.5901 17.1274C75.5522 18.9077 76.0332 21.0668 76.0332 23.6046ZM71.0446 23.6046C71.0446 21.9607 70.7984 20.5743 70.306 19.4455C69.8211 18.3168 69.1355 17.4607 68.2491 16.8774C67.3628 16.294 66.3249 16.0024 65.1355 16.0024C63.9461 16.0024 62.9082 16.294 62.0219 16.8774C61.1355 17.4607 60.4461 18.3168 59.9537 19.4455C59.4688 20.5743 59.2264 21.9607 59.2264 23.6046C59.2264 25.2486 59.4688 26.6349 59.9537 27.7637C60.4461 28.8925 61.1355 29.7486 62.0219 30.3319C62.9082 30.9152 63.9461 31.2069 65.1355 31.2069C66.3249 31.2069 67.3628 30.9152 68.2491 30.3319C69.1355 29.7486 69.8211 28.8925 70.306 27.7637C70.7984 26.6349 71.0446 25.2486 71.0446 23.6046ZM92.3031 18.6615C92.2122 17.7448 91.8221 17.0327 91.1327 16.5251C90.4433 16.0175 89.5077 15.7637 88.3259 15.7637C87.5228 15.7637 86.8448 15.8774 86.2918 16.1046C85.7387 16.3243 85.3145 16.6311 85.019 17.0251C84.7312 17.419 84.5872 17.866 84.5872 18.366C84.5721 18.7827 84.6592 19.1463 84.8486 19.4569C85.0455 19.7675 85.3145 20.0365 85.6554 20.2637C85.9963 20.4834 86.3902 20.6766 86.8372 20.8433C87.2842 21.0024 87.7615 21.1387 88.269 21.2524L90.3599 21.7524C91.3751 21.9796 92.3069 22.2827 93.1554 22.6615C94.0039 23.0402 94.7387 23.5061 95.3599 24.0592C95.9812 24.6122 96.4622 25.2637 96.8031 26.0137C97.1516 26.7637 97.3296 27.6236 97.3372 28.5933C97.3296 30.0175 96.966 31.2524 96.2463 32.2978C95.5342 33.3357 94.5039 34.1425 93.1554 34.7183C91.8145 35.2865 90.1971 35.5705 88.3031 35.5705C86.4243 35.5705 84.788 35.2827 83.394 34.7069C82.0077 34.1311 80.9243 33.2789 80.144 32.1501C79.3713 31.0137 78.966 29.6084 78.9281 27.9342H83.6895C83.7425 28.7145 83.966 29.366 84.3599 29.8887C84.7615 30.4039 85.2955 30.794 85.9622 31.0592C86.6365 31.3168 87.3978 31.4455 88.2463 31.4455C89.0796 31.4455 89.8031 31.3243 90.4168 31.0819C91.038 30.8395 91.519 30.5024 91.8599 30.0705C92.2009 29.6387 92.3713 29.1425 92.3713 28.5819C92.3713 28.0592 92.216 27.6198 91.9054 27.2637C91.6024 26.9077 91.1554 26.6046 90.5645 26.3546C89.9812 26.1046 89.2652 25.8774 88.4168 25.6728L85.8827 25.0365C83.9205 24.5592 82.3713 23.813 81.2349 22.7978C80.0986 21.7827 79.5342 20.4152 79.5418 18.6955C79.5342 17.2865 79.9092 16.0554 80.6668 15.0024C81.4319 13.9493 82.4812 13.1274 83.8145 12.5365C85.1478 11.9455 86.663 11.6501 88.3599 11.6501C90.0872 11.6501 91.5948 11.9455 92.8827 12.5365C94.1781 13.1274 95.1857 13.9493 95.9054 15.0024C96.6251 16.0554 96.9963 17.2751 97.019 18.6615H92.3031ZM100.647 35.241V11.9683H116.329V16.0251H105.567V21.5705H115.522V25.6274H105.567V31.1842H116.374V35.241H100.647ZM120.241 35.241V11.9683H129.559C131.271 11.9683 132.699 12.2221 133.843 12.7296C134.987 13.2372 135.847 13.9418 136.422 14.8433C136.998 15.7372 137.286 16.7675 137.286 17.9342C137.286 18.8433 137.104 19.6425 136.741 20.3319C136.377 21.0137 135.877 21.5743 135.241 22.0137C134.612 22.4455 133.892 22.7524 133.082 22.9342V23.1615C133.968 23.1993 134.797 23.4493 135.57 23.9115C136.35 24.3736 136.983 25.0213 137.468 25.8546C137.953 26.6804 138.195 27.6652 138.195 28.8092C138.195 30.044 137.888 31.1463 137.275 32.116C136.669 33.0781 135.771 33.8395 134.582 34.4001C133.392 34.9607 131.926 35.241 130.184 35.241H120.241ZM125.161 31.2183H129.172C130.544 31.2183 131.544 30.9569 132.172 30.4342C132.801 29.9039 133.116 29.1993 133.116 28.3205C133.116 27.6766 132.96 27.1084 132.65 26.616C132.339 26.1236 131.896 25.7372 131.32 25.4569C130.752 25.1766 130.074 25.0365 129.286 25.0365H125.161V31.2183ZM125.161 21.7069H128.809C129.483 21.7069 130.082 21.5895 130.604 21.3546C131.135 21.1122 131.551 20.7713 131.854 20.3319C132.165 19.8925 132.32 19.366 132.32 18.7524C132.32 17.9115 132.021 17.2334 131.422 16.7183C130.832 16.2031 129.991 15.9455 128.9 15.9455H125.161V21.7069ZM162.783 23.6046C162.783 26.1425 162.302 28.3016 161.34 30.0819C160.386 31.8622 159.082 33.2221 157.431 34.1615C155.787 35.0933 153.939 35.5592 151.886 35.5592C149.817 35.5592 147.961 35.0895 146.317 34.1501C144.673 33.2107 143.374 31.8508 142.42 30.0705C141.465 28.2902 140.988 26.1349 140.988 23.6046C140.988 21.0668 141.465 18.9077 142.42 17.1274C143.374 15.3471 144.673 13.991 146.317 13.0592C147.961 12.1198 149.817 11.6501 151.886 11.6501C153.939 11.6501 155.787 12.1198 157.431 13.0592C159.082 13.991 160.386 15.3471 161.34 17.1274C162.302 18.9077 162.783 21.0668 162.783 23.6046ZM157.795 23.6046C157.795 21.9607 157.548 20.5743 157.056 19.4455C156.571 18.3168 155.886 17.4607 154.999 16.8774C154.113 16.294 153.075 16.0024 151.886 16.0024C150.696 16.0024 149.658 16.294 148.772 16.8774C147.886 17.4607 147.196 18.3168 146.704 19.4455C146.219 20.5743 145.976 21.9607 145.976 23.6046C145.976 25.2486 146.219 26.6349 146.704 27.7637C147.196 28.8925 147.886 29.7486 148.772 30.3319C149.658 30.9152 150.696 31.2069 151.886 31.2069C153.075 31.2069 154.113 30.9152 154.999 30.3319C155.886 29.7486 156.571 28.8925 157.056 27.7637C157.548 26.6349 157.795 25.2486 157.795 23.6046ZM187.814 23.6046C187.814 26.1425 187.333 28.3016 186.371 30.0819C185.417 31.8622 184.114 33.2221 182.462 34.1615C180.818 35.0933 178.97 35.5592 176.917 35.5592C174.849 35.5592 172.993 35.0895 171.349 34.1501C169.705 33.2107 168.405 31.8508 167.451 30.0705C166.496 28.2902 166.019 26.1349 166.019 23.6046C166.019 21.0668 166.496 18.9077 167.451 17.1274C168.405 15.3471 169.705 13.991 171.349 13.0592C172.993 12.1198 174.849 11.6501 176.917 11.6501C178.97 11.6501 180.818 12.1198 182.462 13.0592C184.114 13.991 185.417 15.3471 186.371 17.1274C187.333 18.9077 187.814 21.0668 187.814 23.6046ZM182.826 23.6046C182.826 21.9607 182.58 20.5743 182.087 19.4455C181.602 18.3168 180.917 17.4607 180.03 16.8774C179.144 16.294 178.106 16.0024 176.917 16.0024C175.727 16.0024 174.689 16.294 173.803 16.8774C172.917 17.4607 172.227 18.3168 171.735 19.4455C171.25 20.5743 171.008 21.9607 171.008 23.6046C171.008 25.2486 171.25 26.6349 171.735 27.7637C172.227 28.8925 172.917 29.7486 173.803 30.3319C174.689 30.9152 175.727 31.2069 176.917 31.2069C178.106 31.2069 179.144 30.9152 180.03 30.3319C180.917 29.7486 181.602 28.8925 182.087 27.7637C182.58 26.6349 182.826 25.2486 182.826 23.6046ZM191.459 35.241V11.9683H196.38V22.2296H196.687L205.062 11.9683H210.959L202.323 22.3887L211.062 35.241H205.175L198.8 25.6728L196.38 28.6274V35.241H191.459Z" fill="black" />
            <rect x="0.618225" width="48" height="48" rx="12" fill="#0277FF" />
            <path d="M34.4499 11.7727V36.5H29.9343L19.1765 20.9368H18.9954V36.5H13.7674V11.7727H18.3554L29.0287 27.3239H29.2461V11.7727H34.4499Z" fill="white" />
          </svg>
        </div>

        {isAuthenticated && (
          <HeaderFinder onUserSearch={(text) => {
            'use server';

            return featuser.api.findByText(text).then(res => res.data!);
          }} />
        )}

        {isAuthenticated &&
          <HeaderButton />
        }
      </div>
    </header>
  );
};

